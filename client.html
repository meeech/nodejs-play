<!doctype html>
<html>
  <head>
    <title>socket.io client test</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <script type="text/javascript" src="http://yui.yahooapis.com/3.2.0/build/simpleyui/simpleyui-min.js"></script>
    <script>
// Create new YUI instance, and populate it with the required modules
YUI().use('io', function(Y) {
//Begin Closure
var socket = new io.Socket(null, {port: 8080});


var connect = function() {
    console.log('connecting to game...');
    socket.connect();
};



Y.on("domready", connect);

//End closure
});


      function message(obj){
        var el = document.createElement('p');
        if ('announcement' in obj) el.innerHTML = '<em>' + esc(obj.announcement) + '</em>';
        else if ('message' in obj) el.innerHTML = '<b>' + esc(obj.message[0]) + ':</b> ' + esc(obj.message[1]);
        document.getElementById('chat').appendChild(el);
        document.getElementById('chat').scrollTop = 1000000;
      }
      
      function send(){
        var val = document.getElementById('text').value;
        socket.send(val);
        message({ message: ['you', val] });
        document.getElementById('text').value = '';
      }
      
      function esc(msg){
        return msg.replace(/</g, '&lt;').replace(/>/g, '&gt;');
      };
      
      var socket = new io.Socket(null, {port: 8080});
      socket.connect();
      socket.on('message', function(obj){
        if ('buffer' in obj){
          document.getElementById('form').style.display='block';
          document.getElementById('chat').innerHTML = '';
          
          for (var i in obj.buffer) message(obj.buffer[i]);
        } else message(obj);
      });
    </script>
    
    <h1>Sample chat client</h1>
    <div id="chat"><p>Connecting...</p></div>
    
  </body>
</html>